{"type": "PlanScript", "uri": null, "category": null, "eTag": null, "created": null, "modified": null, "id": "98f04ded-7cf0-4d1b-ba6d-b89c2b229dbb", "name": "HPE-RHEL-wrapper", "description": "Wrapper Script which executes all other scripts", "status": null, "state": null, "planType": "deploy", "content": "# (c) Copyright 2018-2019 Hewlett Packard Enterprise Development LP\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software distributed\n# under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n# CONDITIONS OF ANY KIND, either express or implied. See the License for the\n# specific language governing permissions and limitations under the License.\n\n\n# Wrapper script to execute personalization scrips in ISROOT/scripts directory\n\nupload -<<END /EFI/HPE/isdeploy/HPE-ImageStreamer.bash\n#! /bin/bash\n\n# This script was loaded by HPE Image Streamer\n\n# setup\nISROOT=\"/boot/efi/EFI/HPE/isdeploy/\"\nLOGFILE=\"${ISROOT}../$(basename $0).log\"\n\n# prep\necho \"$(/usr/bin/date)\" >> ${LOGFILE} 2>&1\ncd $ISROOT >> ${LOGFILE} 2>&1\n\n# process\n# - invoke all executables in sub-directory ./scripts (in lexographic order)\n# \tassumes :\n#\t\tall scripts handle their own logging (for later debugging)\n#\t\tare independent/self-contained\n#\t\t\t(but can source info from other sub-directories/files)\n#\t\tif script run\n#\t\t\tsucceeds, then script is moved to ./tmp \n#\t\t\thas issues, leave in place (for later debug)\n# - if entire process is\n#\tsuccessful\n#\t\tremove top-level ISROOT directory\n#\thas errors\n#\t\t\n\nRC=0\n\nfor i in $(/usr/bin/ls scripts/*)\ndo\n\t# Note: execute status is really a function of the FAT partition mount\n\t[ -n ${i} ] && [ -x ${i} ] && {\n\n\t\techo \"=== ${i} \"\n\n\t\tif ${i};\n\t\tthen\n\t\t\t/usr/bin/mv ${i} ./tmp\n\t\telse\n\t\t\tRC=1\n\t\tfi\n\t} >> ${LOGFILE} 2>&1\ndone\n\nif [ ${RC} -eq 0 ];\nthen\n\t{\n\t\t# temp saves\n\t\t\n\t\t/usr/bin/cp -p $(/usr/bin/basename $0) ./tmp\n                \n                 /usr/bin/rm -rf ${ISROOT}\n\n\t} >> ${LOGFILE} 2>&1\nelse\n\t{\t\t\n\t\t/usr/bin/mv -f $(/usr/bin/basename $0) ${ISROOT}../\n\t\techo \"Failures found, please review ${LOGFILE}\"\n\t} >> ${LOGFILE} 2>&1\nfi\n\n\n\nexit 0\nEND", "customAttributes": null, "hpProvided": true, "dependentArtifacts": null}