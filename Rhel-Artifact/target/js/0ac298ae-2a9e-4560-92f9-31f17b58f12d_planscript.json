{"type": "PlanScript", "uri": null, "category": null, "eTag": null, "created": null, "modified": null, "id": "0ac298ae-2a9e-4560-92f9-31f17b58f12d", "name": "HPE-RHEL-Users", "description": "Sets root password and creates Users", "status": null, "state": null, "planType": "deploy", "content": "# (c) Copyright 2018-2019 Hewlett Packard Enterprise Development LP\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software distributed\n# under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n# CONDITIONS OF ANY KIND, either express or implied. See the License for the\n# specific language governing permissions and limitations under the License.\n\n# Script to change root's password and add users\n\nupload -<<END /EFI/HPE/isdeploy/scripts/05configure-users.bash\n#!/bin/bash\n# This script was loaded by HPE Image Streamer\nexec 1> >(logger -s -t $(basename $0)) 2>&1\n\necho \"Starting configure-users script for users: @NewUser@\"\n\n# Change root user password\n\necho \"Changing root password\"\necho \"root:@NewRootPassword@\" | chpasswd\n\n# \"Removing admin user added while creating GI\"\n\nuserdel admin \nrm -rf /home/admin\n\n# Add users\necho \"Adding users\"\n\n#Add comments\nsed -i -e '$a\\#Following users added by HPE Image Streamer' /etc/passwd\nsed -i -e '$a\\#Following users added by HPE Image Streamer' /etc/group\nusers_string=\"@NewUser@\"\n\n#Users will be added with the same password. On first login users have to change their password.\npassword=@NewUsersPassword@\nIFS=',; ' read -r -a array <<< \"$users_string\"\nfor user in \"${array[@]}\"\ndo\n\tif [ $(id -u) -eq 0 ]; \n\tthen\n\t\tegrep \"$user\" /etc/passwd >/dev/null\n\t\tif [ $? -eq 0 ]; \n\t\tthen\n\t\t\techo \"$user User exists!\"\n\t\t\texit 1\n\t\telse\n\t\t\tuseradd -m $user\n\t\t\techo \"$user:$password\" | chpasswd \n\t\t\t[ $? -eq 0 ] && echo \"User $user has been added to system!\" || echo \"Failed to add $user User!\"\n\t\tfi\n\telse\n\t\techo \"Unable to add User $user\"\n \t\texit 2\n\tfi\ndone\n\necho \"Finished configure-users script\"\n\nexit 0\nEND", "customAttributes": null, "hpProvided": true, "dependentArtifacts": null}