{"type": "PlanScript", "uri": null, "category": null, "eTag": null, "created": null, "modified": null, "id": "1525be48-0048-4fef-88e1-efb7dd4d6064", "name": "HPE-RHEL-LVM", "description": "LVM script", "status": null, "state": null, "planType": "deploy", "content": "# (c) Copyright 2018-2019 Hewlett Packard Enterprise Development LP\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software distributed\n# under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n# CONDITIONS OF ANY KIND, either express or implied. See the License for the\n# specific language governing permissions and limitations under the License.\n\n# Script to configure partition using LVM\n\nupload -<<END /EFI/HPE/isdeploy/scripts/09LVM-Configure.bash\n#! /bin/bash\n# to create the partitions programatically (rather than manually)\n# we're going to simulate the manual input to fdisk\n# The sed script strips off all the comments so that we can \n# document what we're doing in-line with the actual commands\n# Note that a blank line (commented as \"default\" will send a empty\n# line terminated with a newline to take the fdisk default.\necho \" LVM Configuration Started\"\nsed -e 's/\\s*\\([\\+0-9a-zA-Z]*\\).*/\\1/' << EOF | fdisk @DiskName:/dev/sda@\n  o # clear the in memory partition table\n  n # new partition\n  p # primary partition\n  1 # partition number 1\n    # default - start at beginning of disk \n  +@FirstPartitionSize:10@G # boot parttion\n  n # new partition\n  p # primary partition\n  2 # partion number 2\n    # default, start immediately after preceding partition\n  +@SecondPartitionSize:10@G # leave blank(default) to extend partition to end of disk\n  p # print the in-memory partition table\n  w # write the partition table\n  q # and we're done\nEOF\n\n#list all disks and partitions\nlsblk \n\n#create physical volume\npvcreate @DiskName:/dev/sda@1 @DiskName:/dev/sda@2\n\n#create physical volume forcefully \nif [ ! $? -eq 0 ]; then\necho y | pvcreate -ff @DiskName:/dev/sda@1\necho y | pvcreate -ff @DiskName:/dev/sda@2\nfi\n\npvdisplay\n\n#create logical volume group\nvgcreate @LvmVolumeGroupName:new_vol_group@ @DiskName:/dev/sda@1 @DiskName:/dev/sda@2\nvgs\n\n#create logical volume\nlvcreate -L@LvmVolumeSize:16@G -n @LvmVolumeName:new_vol@ @LvmVolumeGroupName:new_vol_group@\nlvs\n\necho \"Creating mount point\"\nmkdir /root/LVM-Data1\n\nFS=@FileSystem:XFS@\n\nif [ $FS == XFS ]\nthen\n\tmkfs.xfs /dev/@LvmVolumeGroupName:new_vol_group@/@LvmVolumeName:new_vol@\n\techo \"Formating with XFS fileSystem type\"\t\n\tmount /dev/@LvmVolumeGroupName:new_vol_group@/@LvmVolumeName:new_vol@ /root/LVM-Data1\n\tsed -i -e '$a\\#This file has been altered by Image Streamer.' /etc/fstab\n\tsed -i -e '$a\\/dev/@LvmVolumeGroupName:new_vol_group@/@LvmVolumeName:new_vol@ /root/LVM-Data1 xfs defaults 0 0' /etc/fstab\t\n\t\nelif  [ $FS == EXT4 ]\nthen\n\tmkfs.ext4 /dev/@LvmVolumeGroupName:new_vol_group@/@LvmVolumeName:new_vol@\n\techo \"Formating with EXT4 fileSystem type\"\t\n\tmount /dev/@LvmVolumeGroupName:new_vol_group@/@LvmVolumeName:new_vol@ /root/LVM-Data1\n\tsed -i -e '$a\\#This file has been altered by Image Streamer.' /etc/fstab\n\tsed -i -e '$a\\/dev/@LvmVolumeGroupName:new_vol_group@/@LvmVolumeName:new_vol@ /root/LVM-Data1 ext4 defaults 0 0' /etc/fstab\n\t\nelif  [ $FS == BTRFS ]\nthen\n\tmkfs.btrfs \t/dev/@LvmVolumeGroupName:new_vol_group@/@LvmVolumeName:new_vol@\n\techo \"Formating with BTRFS fileSystem type\"\n\tmount /dev/@LvmVolumeGroupName:new_vol_group@/@LvmVolumeName:new_vol@ /root/LVM-Data1\n\tsed -i -e '$a\\#This file has been altered by Image Streamer.' /etc/fstab\n\tsed -i -e '$a\\/dev/@LvmVolumeGroupName:new_vol_group@/@LvmVolumeName:new_vol@ /root/LVM-Data1 btrfs defaults 0 0' /etc/fstab\n\t\nelif  [ $FS == Disabled ]\nthen\n        echo \"Removing mount point\"\n\trm -rf /root/LVM-Data1\t\nfi\t\n\necho \"LVM configuration completed\"\n\n\nexit 0\nEND", "customAttributes": null, "hpProvided": true, "dependentArtifacts": null}